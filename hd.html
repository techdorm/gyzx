<!DOCTYPE html>
<html>

<head>
    <title>活动广场</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1, maximum-scale=1, user-scalable=no" />
    <link rel="stylesheet" type="text/css" href="static/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="stylesheets/hd.css">
</head>
<body>
    <div class="header">
        <div class="navbar-left">
           <a href="index.html"><i class="fa fa-angle-left back"></i></a>
        </div>
        <h1>活动广场</h1>
    </div>
    <!-- <div class="header-fill"></div> -->
    <div class="container">
        <!-- <div class="preloader"> 下拉刷新 </div> -->
        <div class="swiper-container">
            <div class="swiper-wrapper event-list">
                <div class="preloader">下拉刷新</div>
                <div class="swiper-slide">
                    <a href="#">
                        <div class="event-content">
                            <img src="http://cdn.huodongxing.com/logo/201512/5314304917400/662182726429055_v2small.jpg" alt="跨界大师•鬼才达利 Media-Dali " title="跨界大师•鬼才达利 Media-Dali " class="event-img">
                            <div class="event-body">
                                <h3 class="event-title">跨界大师•鬼才达利 Media-Dali</h3>
                                <p class="event-location">黄浦 淮海中路300号香港新世界大厦11楼</p>
                                <div class="event-state">
                                    11/5 10:00-2/15 20:00
                                    <span class='text-warning'>已结束</span>
                                </div>
                            </div>
                        </div>
                    </a>
                </div>
                <div class="swiper-slide">
                    <a href="#">
                        <div class="event-content">
                            <img src="http://cdn.huodongxing.com/logo/201511/5308109135800/892139648490828_v2small.jpg" class="event-img">
                            <div class="event-body">
                                <h3 class="event-title">阅读列车 | 文字在城市间游走</h3>
                                <p class="event-location">广州 有轨列车广州塔站</p>
                                <div class="event-state">
                                    11/12 08:00-2/10 22:00
                                    <span class='text-muted'>正在进行中</span>
                                </div>
                            </div>
                        </div>
                    </a>
                </div>
                <div class="swiper-slide">
                    <a href="#">
                        <div class="event-content">
                            <img src="http://cdn.huodongxing.com/logo/201601/4319778607700/672220687521058_v2small.jpg" class="event-img">
                            <div class="event-body">
                                <h3 class="event-title">蜗牛Slow Movie春节特映单</h3>
                                <p class="event-location">东城 东城区交道口南大街大兴胡同73号</p>
                                <div class="event-state">
                                    2/10 14:00-2/13 22:30
                                    <span class='text-muted'>正在进行中</span>
                                </div>
                            </div>
                        </div>
                    </a>
                </div>
                <div class="swiper-slide">
                    <a href="#">
                        <div class="event-content">
                            <img src="http://cdn.huodongxing.com/logo/201602/4320209276000/802223677793823_v2small.jpg" class="event-img">
                            <div class="event-body">
                                <h3 class="event-title">惊心动魄私映会！</h3>
                                <p class="event-location">广州 广州大道中289号</p>
                                <div class="event-state">
                                    2/14 周日 19:30-23:30
                                    <span class='text-warning'>已结束</span>
                                </div>
                            </div>
                        </div>
                    </a>
                </div>
                <div class="swiper-slide">
                    <a href="#">
                        <div class="event-content">
                            <img src="http://cdn.huodongxing.com/logo/201601/3316032484800/592194671772310_v2small.jpg" class="event-img">
                            <div class="event-body">
                                <h3 class="event-title">前海虚拟现实科幻乐园畅玩体验</h3>
                                <p class="event-location">深圳 南山区前海万科企业公馆cctv大楼首层虚拟现实主题乐园</p>
                                <div class="event-state">
                                    1/5 00:00-2/15 00:00
                                    <span class='text-warning'>已结束</span>
                                </div>
                            </div>
                        </div>
                    </a>
                </div>
                <div class="swiper-slide">
                    <a href="#">
                        <div class="event-content">
                            <img src="http://cdn.huodongxing.com/logo/201512/3313467696100/442176897927851_v2small.jpg" class="event-img">
                            <div class="event-body">
                                <h3 class="event-title">eMoCA&#183;展览|我的花园My Garden -罗发辉个展</h3>
                                <p class="event-location">深圳 福田保税区槟榔道创意保税园（原福兴大厦）首层 e当代美术馆</p>
                                <div class="event-state">
                                    12/27 10:00-2/16 18:00
                                    <span class='text-muted'>正在进行中</span>
                                </div>
                            </div>
                        </div>
                    </a>
                </div>
            </div>
        </div>
    </div>
</body>
<script src="static/js/jquery.min.js"></script>
<script src="static/js/idangerous.swiper.min.js"></script>
<script>
    var holdPosition = 0;
    var mySwiper = new Swiper('.swiper-container',{
    slidesPerView:'auto',
    mode:'vertical',
    watchActiveIndex: true,
    longSwipesRatio: 0.1,
    observer:true,//修改swiper自己或子元素时，自动初始化swiper
    observeParents: true,
    onTouchStart: function() {
        holdPosition = 0;
        $('.preloader').html('下拉刷新');
        // $('.preloader').addClass('visible');
    },
    onResistanceBefore: function(s, pos){
        holdPosition = pos;
    },
    onTouchEnd: function(){
        if (holdPosition>45) {
        mySwiper.setWrapperTranslate(0,45,0)
        mySwiper.params.onlyExternal=true
        loadNewSlides();
        }
    }
    })
    var slideNumber = 0;
    function loadNewSlides(){
        $('.preloader').html('<i class="fa fa-spinner fa-spin"></i> 正在刷新');
        //Prepend new slide
        $.get('new.html').success(function(data){
            console.log("success");
            var newEventList = JSON.parse(data);
            mySwiper.removeAllSlides();
            var i = 0;
            for (i in newEventList) {
                $('.preloader').html('<i class="fa fa-check-circle-o"> 刷新成功</i>');
                var newEvent = newEventList[i];
                var state = ['',''];
                if (newEvent.state == 1) {
                    state = ["正在进行","text-muted"];
                } else {
                    state = ["已结束","text-warning"];
                }
                mySwiper.appendSlide('<div class="swiper-slide"><a href="'+'#'+'"><div class="event-content"><img src="'+newEvent.img+'" alt="'+newEvent.title+'" title="'+newEvent.title+'" class="event-img"><div class="event-body"><h3 class="event-title">'+newEvent.title+'</h3><p class="event-location">'+newEvent.location+'</p><div class="event-state">'+newEvent.time+'<span class="'+state[1]+'">'+state[0]+'</span></div></div></div></a>');
            }
        }).error(function(){
            console.log("fail");
            $('.preloader').html('<i class="fa fa-exclamation-triangle"> 刷新失败</i>');
        });
        setTimeout(function() {
            //Release interactions and set wrapper
            mySwiper.setWrapperTranslate(0,0,0)
            mySwiper.params.onlyExternal=false;
            //Update active slide
            mySwiper.updateActiveSlide(0)
        }, 1000);
        slideNumber++;
    }
</script>
</html>
