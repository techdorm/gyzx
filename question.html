<!doctype html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1, maximum-scale=1, user-scalable=no" />
    <title>留言广场</title>
    <!-- <link rel="stylesheet" type="text/css" href="static/bootstrap/css/bootstrap.css"> -->
    <link rel="stylesheet" type="text/css" href="static/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="static/css/dropload.css">
    <!-- <link rel="stylesheet" type="text/css" href="stylesheets/reset.css"> -->
    <link rel="stylesheet" type="text/css" href="stylesheets/question.css">
    <script src="static/js/jquery.min.js"></script>
    <style type="text/css">

    
    </style>
     <script type="text/javascript">
      $(function() {
            $("ul > li").click(tab);
            function tab() {
                $(this).addClass("u-selected").siblings().removeClass("u-selected");
                var tab = $(this).attr("title");
                $("#" + tab).show().siblings().hide(); 
            };
        });
    //edit界面切换
    $(function(){
        $('.u-edit').click(function(){
            $("#opinion").hide();
            $('#write').show();
        });
        $('.u-back,.u-send').click(function(){
            $('#write').hide();
            $("#opinion").show();
        });
    });


</script>
</head>

<body>
    <div id="opinion">
        <div class="g-header">
            <div class="u-navbar-left">
                <div id="return">
                    <a href="index.html"><i class="fa fa-angle-left u-back"></i></a>
                </div>
            </div> 
            <div class="tab">
                <ul class="m-menu">
                    <li class="u-selected u-found" title="found">发现</li>
                    <li class="u-mine" title="mine">我的<span class="" id="MessageCount"></span></li>
                    
                </ul>
            </div>

            <div class="u-navbar-right">
                <a href="search.html"><i class="fa fa-search u-search"></i></a>
            </div>
        </div>
        <div class="g-content">
           <div id="found" class="lists" style="display:block">
                   <a class="u-item" href="#">
                       <h3>填错志愿是一种什么体验？</h3>
                       <span class="u-liulan">12749次浏览</span>
                   </a>
                   
                       <a class="u-item" href="#">
                           <h3>学校宿舍什么时候开门啊</h3>
                           <span class="u-liulan">31849次浏览</span>
                       </a>
                       
                  
                       <a class="u-item" href="#">
                           <h3>离学校最近工商银行在哪里？</h3>
                           <span class="u-liulan">163次浏览</span>
                       </a>
                       
                  
                       <a class="u-item" href="#">
                           <h3>什么时候通宵供电啊</h3>
                           <span class="u-liulan">149次浏览</span>
                       </a>
                       
                 
                       <a class="u-item" href="#">
                           <h3>新生去哪里报到</h3>
                           <span class="u-liulan">127次浏览</span>
                       </a>
                       
                       <a class="u-item" href="#">
                           <h3>暑假什么时候开始啊</h3>
                           <span class="u-liulan">123次浏览</span>
                       </a>
                       
                   
                       <a class="u-item" href="#">
                           <h3>如果抢课没抢到去哪里签课啊</h3>
                           <span class="u-liulan">244次浏览</span>
                       </a>
                       
                  
                       <a class="u-item" href="#">
                           <h3>假期留校怎么办理</h3>
                           <span class="u-liulan">127849次浏览</span>
                       </a>
           </div> 
           <div id="mine"  class="lists" style="display:none">
                       <a class="u-item" href="#">
                           <h3>如果抢课没抢到去哪里签课啊</h3>
                           <span class="u-liulan">244次浏览</span>
                       </a>
                       <a class="u-item" href="#">
                           <h3>饭卡丢了去哪里补办</h3>
                           <span class="u-liulan">127849次浏览</span>
                       </a>
                       <a class="u-item" href="#">
                           <h3>学校附近有什么小吃呀</h3>
                           <span class="u-liulan">127849次浏览</span>
                       </a>
                      
           </div>
        </div>
        <div class="g-footer">
            <a href="#">
                <div class="u-edit">
                    <i class="fa fa-pencil-square-o u-fa-pencil"></i>
                </div>
            </a> 
        </div>
    </div>
    
    <div id="write" style="display:none;" >
            <div class="g-header">
                <div class="u-navbar-left">
                    <i class="fa fa-angle-left u-back"></i>
                </div>
                <div class="u-question" style="color:#FFF;">
                    问题
                </div>
                <div class="u-navbar-right">
                    <i class="fa fa-paper-plane u-send"></i>
                </div>
            </div>
            <div class="g-comment">
                <div class="panel">
                  <div class="panel-heading">
                        <input class="m-questitle" placeholder="标题">
                        <span class="input-bar"></span>
                  </div>
                  <div class="panel-body" style="padding-left: 10px;">
                       <!--  <textarea rows="10" cols="30" placeholder="输入内容"></textarea> -->
                       <div class="u-test_box" placeholder="输入内容" contenteditable="true" ></div>
                  </div>
                </div>
            </div>
    </div>    
</body>

<script src="static/js/dropload.js"></script>

<script type="text/javascript">
 $(function(){
        var counter = 0;
        // 每页展示4个
        var num = 4;
        var pageStart = 0,pageEnd = 0;

        // dropload
        $('.g-content').dropload({
            scrollArea : window,
            domUp : {
                domClass   : 'dropload-up',
                domRefresh : '<div class="dropload-refresh">↓下拉刷新</div>',
                domUpdate  : '<div class="dropload-update">↑释放更新</div>',
                domLoad    : '<div class="dropload-load"><span class="loading"></span>加载中...</div>'
            },
            domDown : {
                domClass   : 'dropload-down',
                domRefresh : '<div class="dropload-refresh">↑上拉加载更多</div>',
                domLoad    : '<div class="dropload-load"><span class="loading"></span>加载中...</div>',
                domNoData  : '<div class="dropload-noData">暂无数据</div>'
            },
            loadUpFn : function(me){
                $.ajax({
                    type: 'GET',
                    url: 'static/json/question.json',
                    dataType: 'json',
                    success: function(data){
                        var result = '';
                        for(var i = 0; i < data.lists.length; i++){
                            result +=   '<a class="u-item" href="#">'
                                            +'<h3>'+data.lists[i].title+'</h3>'
                                            +'<span class="u-liulan">'+data.lists[i].liulan+"次浏览"+'</span>'
                                        +'</a>';
                        }
                        // 为了测试，延迟1秒加载
                        setTimeout(function(){
                            $('#found').html(result);
                            // 每次数据加载完，必须重置
                            me.resetload();
                        },500);
                    },
                    error: function(xhr, type){
                        alert('Ajax error!');
                        // 即使加载出错，也得重置
                        me.resetload();
                    }
                });
            },
            loadDownFn : function(me){
                $.ajax({
                    type: 'GET',
                    url: 'static/json/question.json',
                    dataType: 'json',
                    success: function(data){
                        var result = '';
                        counter++;
                        pageEnd = num * counter;
                        pageStart = pageEnd - num;

                        for(var i = pageStart; i < pageEnd; i++){
                            result +=   '<a class="u-item" href="#">'
                                            +'<h3>'+data.lists[i].title+'</h3>'
                                            +'<span class="u-liulan">'+data.lists[i].liulan+"次浏览"+'</span>'
                                        +'</a>';
                            if((i + 1) >= data.lists.length){
                                // 锁定
                                me.lock();
                                // 无数据
                                me.noData();
                                break;
                            }
                        }
                        // 为了测试，延迟1秒加载
                        setTimeout(function(){
                            $('#found').append(result);
                            // 每次数据加载完，必须重置
                            me.resetload();
                        },500);
                    },
                    error: function(xhr, type){
                        alert('Ajax error!');
                        // 即使加载出错，也得重置
                        me.resetload();
                    }
                });
            },
            threshold : 50
        });
    });
//CheckMessaege
CheckMessage=function(){
    $.ajax({
        type: 'GET',
        url:'static/json/message.json',
        dataType:'json',

        success:function(data){
            console.log("success");
            var num=0;
            for(var i=0;i<data.lists.length;i++){
                if(data.lists[i].status==0)
                    num++;
            }
           if(num!=0)
             {
                $('#MessageCount').html(num);
                $('#MessageCount').addClass('u-unread');
             }
             else{
                 $('#MessageCount').html('');
                 $('#MessageCount').removeClass('u-unread');
             }
        },
        error:function(xhr,type){
            alert('加载错误');
         }
    });
    window.setTimeout(CheckMessage,5000);
}
$(document).ready(function() {
    CheckMessage();
}); 

</script>


</html>
