<!DOCTYPE html>
<html style="height: 100%">
<head>
   <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
     <title>寝室卫生</title>
    <link rel="stylesheet" type="text/css" href="static/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="static/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="static/css/ui-dialog.css">
    <script src="static/js/jquery.min.js"></script>
    <script src="static/js/dialog-min.js"></script>
    <script src="static/js/echart/echarts.min.js"></script>
    <style type="text/css">
    /* ------------------------------------------
      RESET  
    --------------------------------------------- */
    body, div,
    h1, h2, h3, h4, h5, h6,
    p, blockquote, pre, dl, dt, dd, ol, ul, li, hr,
    fieldset, form, label, legend, th, td,
    article, aside, figure, footer, header, hgroup, menu, nav, section,
    summary, hgroup {
      margin: 0;
      padding: 0;
      border: 0;
    }
    body{
        font-size:1.5em;
    }   
    a,a:active,a:hover {
      outline: 0;
      text-decoration: none;
    }
    html,body { height:100%; }
   
	/* basic css */

    .header {
  position: fixed;
  z-index: 1060;
  top: 0;
  right: 0;
  left: 0;
  height: 45px;
  border-bottom: 1px solid #43A382;
  background-color: #45A673;
  -webkit-box-shadow: 0 1px 1px rgba(98, 98, 98, 0.3);
  box-shadow: 0 1px 1px rgba(98, 98, 98, 0.3); }
  .header h1 {
    color: #fff;
    font-size: 18px;
    line-height: 44px;
    position: absolute;
    left: 50%;

    -webkit-transform: translate(-50%, 0);
    text-align: center;
    font-family: "YouYuan"; }
  .header .navbar-left {
    float: left;
    /*color: #fff;*/ }
    .header .navbar-left .back {
      color: #FFF;
      font-size: 2.5em; }
  .header .navbar-left > * {
    display: table-cell;
    height: 45px;
    padding-right: 10px;
    padding-left: 10px;
    vertical-align: middle; }

    .now {
  padding-top: 45px; 
  }
  .now .panel{
    margin-bottom: 0;
  }
  .now .week,.now .month,.now .year{
    font-size: 2rem; }
  .now .fa-calendar {
    color: #949594;
    display: table-cell;
    height: 45px;
    padding-left: 10px;
    vertical-align: middle;
    font-size: 2em; }

	 .panel-body{
	padding:5px 15px;
    }

    #container{
    padding:20px 10px;
		height:70%;
    width:100%;
    }
    </style>
</head>

<body>
    <div class="header">
        <div class="navbar-left">
           <a href="index.html"><i class="fa fa-angle-left back"></i></a>
        </div>
        <h1>寝室卫生</h1>
    </div>
    <div class="now"> 
      <div class="panel panel-default">
          <div class="panel-heading"><span class="year">2016</span>/<span class="month">4</span>/第<span class="week">1</span>周
               <span id="calender">
               <i class="fa fa-calendar pull-right" aria-hidden="true" data-event="test"></i>
              <!--  <button data-event="test">open dialog</button> -->
               </span>
          </div>
      </div>
    </div>
  	  <div class="panel panel-default" style="margin-bottom:30px;">
          <div class="panel-heading">
            <span>总分</span>
            <div class="pull-right score">95</div>
          </div>     
  		    <div class="panel-body">
            <div>
               <span>个人得分</span>
               <div class="pull-right personal">30</div>
            </div>
            <div >
               <span>备注</span>
               <div class="pull-right notes">阳台没打扫</div>
            </div>
          </div> 
           <div class="photo" >
                <i class="fa fa-picture-o fa-2x pull-right" style="padding:5px 10px 10px 0;"></i>
         </div>
      </div>
     
     
   

    <div id="container"></div>
    <script type="text/javascript">
    var dom = document.getElementById("container");
    var myChart = echarts.init(dom);
    myChart.showLoading({text: "图表数据正在努力加载..."});
    option = null;
    option = {
        // title : {
        //     text: '寝室卫生',
        // },
        calculable : true, //载入时的动态效果
        color:['#FF7F50'],
        
        tooltip : {
            show: "ture",  
        },
        // toolbox: {
        //     show : true,
        //     orient: 'horizontal',      
        //     x: 'right',              
        //     y: 'top',    
        //     padding: 15,             
        //     showTitle: true,       
        //     feature : {
        //         myTool : {
        //             show : true,
        //             title : '查看照片',
        //             icon :   'image://static/images/photo.png',
        //             onclick : function (){
        //                 alert('myToolHandler');
        //             }
        //         }
        //     }               
        // },   
        polar : [
           {
               indicator : [
                   { text: '地面10分', max: 10},
                   { text: '死角10分', max: 10},
                   { text: '爬梯5分', max: 5},
                   { text: '卫生间10分', max: 10},
                   { text: '门窗5分', max: 5},
                   { text: '阳台10分', max: 10},
                   { text: '违禁电器20分',max:20}
                ],
                radius : 80,
                center : ['50%', '50%'],
            }
        ],
        calculable : true,
        series : [
            {
                name: "寝室卫生",
                type: "radar",
                data : [
                    {
                        value : []
                    }
                ]
            }
        ]
    };
     
    CheckMessage=function(){
            $.ajax({
                type: "GET",
                async: false,
                url: 'static/json/clean.json',
                dataType: "json",
                success: function (result) {
                   console.log("success");
                   
                    if(result.status ==200){
                        option.series[0].data[0].value= result.data[0].week[0].value;
                        $('.notes')[0].innerHTML=result.data[0].week[0].notes;
                        $('.personal')[0].innerHTML=result.data[0].week[0].personal;
                          var arr=option.series[0].data[0].value;
                          console.log(arr);
                          var sum = 0;
                          for (var i = 0; i < arr.length; i++){
                              sum += parseInt(arr[i]);
                          }
                          sum+=parseInt($('.personal')[0].innerHTML);
                          console.log(sum);
                          $('.score')[0].innerHTML=sum;

                        // console.log(result.data[0].week[0].notes);
                       //  console.log(option.series);
                       // console.log(result.data[0].week[0].pic);
                       var picurl=result.data[0].week[0].pic;
                        myChart.hideLoading();
                        myChart.setOption(option);

                         $('.photo').on('click', function () {
                        var x = dialog({
                          title: '卫生检查照片',
                          content: '<img src="" style="width:250px;" id="photo" alt="" />',
                          okValue: '确 定',
                          quickClose: true,
                          cancelValue: '关闭',
                          cancel: function () {}
                        });
                        $("#photo").attr("src",picurl);
                        x.show();
                      });

                    }
                   
                },
                error: function (errorMsg) {
                  alert("数据加载失败，请刷新");
                 // console.log("error");

                }
            });
            // window.setTimeout(CheckMessage,5000);
    }

    $(document).ready(function() {
        CheckMessage();
    }); 
    </script>
    <script type="text/javascript">
      $('i[data-event=test]').on('click', function () {
          var d = dialog({
          title: '请选择月份',
          content: ' <input id="user_date" class="form-control" type="month" min="2016-1" max="2016-6"/> <div class="form-group"><label class="control-label">选择周数</label><select class="form-control" id="week" name="week" data-validation="select_required"><option value="0" selected disabled>请选择第几周</option><option value="1">第1周</option><option value="2">第2周</option><option value="3">第3周</option><option value="4">第4周</option></select></div> ',
          height: 100,
          width: 300,
          okValue: '确 定',
          ok: function () {
            var x=$("#user_date").val();
            console.log(x);
            $(".month")[0].innerText=x[5]+x[6];
            $(".year")[0].innerText=x[0]+x[1]+x[2]+x[3]; 
            var y=$("#week").val();
            console.log(y);
            $(".week")[0].innerText=y[0];
            var m=parseInt(x[5]+x[6]);
            console.log(m);
            var a=new Date;
            var nowmonth=a.getMonth();
             console.log(nowmonth+1-m);
            d.close().remove();
              $.ajax({
                  type: "GET",
                  async: false,
                  url: 'static/json/clean.json',
                  dataType: "json",
                  success: function (result) {
                     console.log("success");
                      if(result.status ==200){
                          option.series[0].data[0].value = result.data[nowmonth+1-m].week[y-1].value;
                          $('.notes')[0].innerHTML=result.data[nowmonth+1-m].week[y-1].notes;
                          $('.personal')[0].innerHTML=result.data[nowmonth+1-m].week[y-1].personal;
                          var arr=option.series[0].data[0].value;
                          console.log(arr);
                          var sum = 0;
                          for (var i = 0; i < arr.length; i++){
                              sum += parseInt(arr[i]);
                          }
                          sum+=parseInt($('.personal')[0].innerHTML);
                          console.log(sum);
                          $('.score')[0].innerHTML=sum;
                           // console.log(option.series); 
                           //  console.log(result.data[nowmonth+1-m].week[y-1].pic);
                           var picurl=result.data[nowmonth+1-m].week[y-1].pic;
                          myChart.hideLoading();
                          myChart.setOption(option);

                         $('.photo').on('click', function () {
                            $("#photo").attr("src",picurl);
                          });
                      }
                  },
                  error: function (errorMsg) {
                    alert("数据加载失败，请刷新")
                  }
              });
          },
          cancelValue: '取消',
          cancel: function () {}
        });

        d.showModal();
      });






       
    </script>
    
</body>