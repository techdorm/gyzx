<!DOCTYPE html>
<html>
<head>
<title>维修评价</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1, maximum-scale=1, user-scalable=no" />
<link rel="stylesheet" type="text/css" href="../../static/bootstrap/css/bootstrap.css">
<link rel="stylesheet" type="text/css" href="../../static/css/buttons.css">
<link rel="stylesheet" type="text/css" href="../../static/font-awesome/css/font-awesome.css">
<link rel="stylesheet" type="text/css" href="../../stylesheets/reset.css">
<link rel="stylesheet" type="text/css" href="../../static/css/ui-dialog.css">
<script src="../../static/js/jquery.min.js"></script>
<script src="../../static/bootstrap/js/bootstrap.min.js"></script>
<script src="../../static/js/dialog-min.js"></script>
<style type="text/css">
	* {
		margin:0;
		padding:0;
		list-style-type:none;
	}
	body {
		color:#666;
		font:14px/1.5 Arial;
		 background-color:#F7F7F7;/*#F9F9F9;*/
	}
	a{
		color:#5F5F5F;
	}
	.header {
	    position: fixed;
	    z-index: 1060;
	    top: 0;
	    right: 0;
	    left: 0;
	    height: 45px;
	    border-bottom: 1px solid #43A382;
	    background-color: #45A673;
	    -webkit-box-shadow: 0 1px 1px rgba(98,98,98,.3);
	    box-shadow: 0 1px 1px rgba(98,98,98,.3);
		}

		.header h1 {
	    color: #fff;
	    font-size: 18px;
	    line-height: 44px;
	    position: absolute;
	    left: 50%;
	    -webkit-transform: translate(-50%,0);
	    text-align: center;
	    font-family:"YouYuan";
		}
		
		.header .navbar-left {
		    float: left;
		    /*color: #fff;*/
		}
	    .navbar-left>* {
	        display: table-cell;
	        height: 45px;
	        padding-right: 10px;
	        padding-left: 10px;
	        vertical-align: middle;
	    }
		.back {
	        color: #FFF;
	        font-size: 2.5em;
	    }

	/* star */
	#star {
		position:absolute;
		top:80%;
		left:10%;
		height:24px;
	}
	#star ul, #star span {
		float:left;
		display:inline;
		height:19px;
		line-height:19px;
		font-size: 17px;
	}
	#star ul {
		margin:0 10px;
	}
	#star li {
		float:left;
		width:30px;
		cursor:pointer;
		text-indent:-9999px;
		background:url(../../static/images/star.png) no-repeat;
	}
	#star strong {
		color:#f60;
	/*	padding-left:10px;*/
	}
	#star li.on {
		background-position:0 -28px;
	}
	#submit {
		position:absolute;
		bottom:0;
		width:100%;
		height:50px;
		background-color:#45A673;
		color:#FFF;
		font-size: 18px;
		font-family:"YouYuan";
	}
	.text-warning {
    color: #ffa620;
	}
	.text-muted {
    color: #62b651;
    } 
     .wx-content {
    /*  padding-top: 15px;*/
      padding-bottom: 15px; 
  }
    .wx-body {
      line-height: 1;
     /* color: #7d7d7d; */
      color:#333;
      background-color: #FFF;
      width:100%;
      height:300px;
    }
      .wx-layout {
      padding:5px;
      padding-left: 10px;
      margin-bottom: 2px;
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis; }

    .preloader {
      line-height: 45px;
      height: 45px;
      width: 100%;
      background: transparent; }
      .fa-wrench{
      	color:#333;
      	padding:5px 15px;
      	font-size: 1.5em;
      }
      .font{
      	font-size: 15px;
      	color:#5F5F5F;;
      }
	 .fa-picture-o{font-size:1.5em;
	 padding:5px 10px 5px 0;}
       

</style>
</head>
<body>
<div class="header">
    <div class="navbar-left">
       <a href="repair_history.html"><i class="fa fa-angle-left back"></i></a>
    </div>
    <h1>维修评价</h1>
</div>
<div class="wx-history">
 	<div class="preloader"></div>

</div>
<div id="star"> <span>维修评价</span>
  <ul>
    <li><a href="javascript:;">1</a></li>
    <li><a href="javascript:;">2</a></li>
    <li><a href="javascript:;">3</a></li>
    <li><a href="javascript:;">4</a></li>
    <li><a href="javascript:;">5</a></li>
  </ul>
  <span></span>
</div>
<input type="submit" class="btn btn-default" id="submit" value="提交">	
<script type="text/javascript"> 

$('#submit').click(function(event){
	 // ajax
	   $.post("vote.php",{
	            vote: iStar,
	            vote_remark: $('#vote_remark').val(),
	            },function(data){
	            console.log("success");
	   });           
});

$(document).ready(function(){
	var oStar = document.getElementById("star");
	var aLi = oStar.getElementsByTagName("li");
	var oUl = oStar.getElementsByTagName("ul")[0];
	var oSpan = oStar.getElementsByTagName("span")[1];
	var oP = oStar.getElementsByTagName("p")[0];
	var i = iScore = iStar = 0;
	
	
	for (i = 1; i <= aLi.length; i++){
		aLi[i - 1].index = i;
		
		
		//鼠标离开后恢复上次评分
		aLi[i - 1].onmouseout = function (){
			fnPoint();
		};
		
		//点击后进行评分处理
		aLi[i - 1].onclick = function (){
			fnPoint(this.index);
			iStar = this.index;
			oSpan.innerHTML ="<strong>" + (this.index) + " 星</strong>";
		}
	}
	
	//评分处理
	function fnPoint(iArg){
		//分数赋值
		iScore = iArg || iStar;
		for (i = 0; i < aLi.length; i++) aLi[i].className = i < iScore ? "on" : "";	
	}


	$.ajax({
		type:"GET",
		async:false,
		url:'../../static/json/repair_one.json',
		dataType:"json",
		success:function(data){
			console.log("success");

			var wxstate = ['',''];	        
			wxstate = ["已修复","text-muted"]; 
	         
			var result = '';
			result +=
			'<div class="wx-item">'+
	            '<div class="wx-content">'+
	            	'<div class="wx-pic">'+
	            	     '<i class="fa fa-wrench" ></i>'+
	            		    '<div class="photo" style="display:inline">'+
			              		'<i class="fa fa-picture-o artdia pull-right"></i>'+
			                '</div>'+
	            	'</div>'+
	                '<div class="wx-body">'+
	                	'<div class="wx-layout font">'+
	                    	'报修详情：'+
	                    	'<span>'+data.result[0].remark+'</span>'+
	                    '</div>'+
	                    '<div class="wx-layout font">'+
	                    	'报修分类: '+
	                    	'<span>'+data.result[0].bcatalogName+'</span>'+
	                    '</div>'+
	                    '<div class="wx-layout font">'+
	                    	'报修时间: '+
	                       '<span>'+data.result[0].datetime+'</span>'+
	                    '</div>'+
	                    '<div class="wx-layout font">'+
	                        '维修状态:'+
	                    	'<span class="'+wxstate[1]+'">'+wxstate[0]+'</span>'+
	                    '</div>'+
	                    '<div class="wx-layout font">'+
	                        '维修师傅:'+
	                    	'<span>'+data.result[0].wxsf+'</span>'+
	                    '</div>'+
	                    '<div class="wx-layout font">'+
	                        '师傅手机:'+
	                    	'<a>'+data.result[0].sfphone+'</a>'+
	                    '</div>'+
	                    '<div class="wx-layout font">'+
	                        '维修评价:'+
	                    '</div>'+
	                    '<textarea id="vote_remark" class="form-control" rows="5" placeholder="客官，对此次维修还满意吗">'+data.result[0].vote_remark+'</textarea>'+
	                '</div>'+
	            '</div>'+
            '</div>';
		

		var picurl=data.result[0].photo;
		$('.wx-history').append(result);
		if(data.result[0].vote!=null)
			{fnPoint(data.result[0].vote);
		    $('input[type="submit"]').attr("value","已评价"); 
		    $('input[type="submit"]').attr("disabled", true);
		    $('#vote_remark').attr("disabled", true);
		    // $('li').prop("disabled", true);
			}

		$('.artdia').on('click', function () {
          var x = dialog({
            title: '报修照片',
            content: '<img src="" style="width:250px;" id="photo" alt="" />',
            cancelValue: '关闭',
            cancel: function () {}
         });
        $("#photo").attr("src",picurl);
        x.showModal();
  		});

		}

	})
})


 




</script>
</body>
</html>
